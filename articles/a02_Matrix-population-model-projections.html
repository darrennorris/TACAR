<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Matrix population model projections • TACAR</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Matrix population model projections">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">TACAR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/a01_Interactive-map.html">Population change map</a></li>
    <li><a class="dropdown-item" href="../articles/a02_Matrix-population-model-projections.html">Matrix population model projections</a></li>
    <li><a class="dropdown-item" href="../articles/a03_Adult-survival-scenarios.html">Adult survival scenarios</a></li>
    <li><a class="dropdown-item" href="../articles/a13_prep_river_points.html">Prepare river points</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/darrennorris/TACAR/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">



<script src="a02_Matrix-population-model-projections_files/kePrint-0.0.1/kePrint.js"></script><link href="a02_Matrix-population-model-projections_files/lightable-0.0.1/lightable.css" rel="stylesheet">
<link href="a02_Matrix-population-model-projections_files/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet">
<script src="a02_Matrix-population-model-projections_files/htmlwidgets-1.6.4/htmlwidgets.js"></script><script src="a02_Matrix-population-model-projections_files/viz-1.8.2/viz.js"></script><link href="a02_Matrix-population-model-projections_files/DiagrammeR-styles-0.2/styles.css" rel="stylesheet">
<script src="a02_Matrix-population-model-projections_files/grViz-binding-1.0.11/grViz.js"></script><div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Matrix population model projections</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/darrennorris/TACAR/blob/main/vignettes/a02_Matrix-population-model-projections.Rmd" class="external-link"><code>vignettes/a02_Matrix-population-model-projections.Rmd</code></a></small>
      <div class="d-none name"><code>a02_Matrix-population-model-projections.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="organization">Organization<a class="anchor" aria-label="anchor" href="#organization"></a>
</h2>
<p>Split into three parts:</p>
<ul>
<li><p>Projections<br>
This section includes code and workflow used to calculate deterministic
and stochastic population projections with stage-based Matrix Population
Models.</p></li>
<li><p>Scenario integration<br>
This section integrates the population projections across spatially
explicit conservation management scenarios.</p></li>
<li><p>Results<br>
Key findings and graphics of the results obtained.</p></li>
</ul>
</div>
<div class="section level2">
<h2 id="packages">Packages<a class="anchor" aria-label="anchor" href="#packages"></a>
</h2>
<p>The following packages are necessary to run the workflow, which
integrates differrent data types, runs matrix population projections and
produces results:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://had.co.nz/plyr" class="external-link">plyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyselect.r-lib.org" class="external-link">tidyselect</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://forcats.tidyverse.org/" class="external-link">forcats</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://hbiostat.org/R/Hmisc/" class="external-link">Hmisc</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">popdemo</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">popbio</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/jonesor/Rcompadre" class="external-link">Rcompadre</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/jonesor/Rage" class="external-link">Rage</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://darrennorris.github.io/TACAR/">TACAR</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://readxl.tidyverse.org" class="external-link">readxl</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">mgcv</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="projections">Projections<a class="anchor" aria-label="anchor" href="#projections"></a>
</h2>
<div class="section level3">
<h3 id="section-objectives">Section objectives<a class="anchor" aria-label="anchor" href="#section-objectives"></a>
</h3>
<ul>
<li><p>Projection parameters<br>
Loads data frame with population parameters and explores the structure
of stage-based matrix models.</p></li>
<li><p>Projection models<br>
Run deterministic and stochastic projections, combine results and export
for future use.</p></li>
<li><p>Model lookup<br>
Summarise projection models and export for future use in scenario
modelling.</p></li>
</ul>
</div>
<div class="section level3">
<h3 id="projection-parameters-">Projection parameters.<a class="anchor" aria-label="anchor" href="#projection-parameters-"></a>
</h3>
<p>Each row holds a unique set of parameters for a matrix population
model. This reflects diverse recovery (conservation action) and
extinction (threat) scenarios.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dt</span> <span class="op">&lt;-</span> <span class="fu">TACAR</span><span class="fu">::</span><span class="fu"><a href="../reference/pop01_param_poun.html">pop01_param_poun</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co"># Population size constant.</span></span>
<span><span class="va">nf</span> <span class="op">&lt;-</span> <span class="fl">10</span></span>
<span><span class="va">dt</span><span class="op">$</span><span class="va">adultF_n</span> <span class="op">&lt;-</span> <span class="va">nf</span></span>
<span><span class="co"># No data on density dependence for any South American freshwater turtle.</span></span>
<span><span class="co"># Here include a generous 20% ceiling on maximum population increase.</span></span>
<span><span class="va">ceiling_threshold</span> <span class="op">&lt;-</span> <span class="va">nf</span> <span class="op">+</span> <span class="op">(</span><span class="va">nf</span> <span class="op">*</span> <span class="fl">0.2</span><span class="op">)</span></span></code></pre></div>
The first few rows should look like this….
<table class="table table" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead><tr>
<th style="text-align:left;">
species
</th>
<th style="text-align:left;">
type
</th>
<th style="text-align:right;">
first_year
</th>
<th style="text-align:right;">
a1
</th>
<th style="text-align:right;">
a2
</th>
<th style="text-align:right;">
a3
</th>
<th style="text-align:right;">
a4
</th>
<th style="text-align:right;">
b1
</th>
<th style="text-align:right;">
b2
</th>
<th style="text-align:right;">
b3
</th>
<th style="text-align:right;">
b4
</th>
<th style="text-align:right;">
c1
</th>
<th style="text-align:right;">
c2
</th>
<th style="text-align:right;">
c3
</th>
<th style="text-align:right;">
c4
</th>
<th style="text-align:right;">
d1
</th>
<th style="text-align:right;">
d2
</th>
<th style="text-align:right;">
d3
</th>
<th style="text-align:right;">
d4
</th>
<th style="text-align:left;">
akey
</th>
<th style="text-align:right;">
adultF_n
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
Podocnemis unifilis
</td>
<td style="text-align:left;">
base
</td>
<td style="text-align:right;">
0.0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
10.74
</td>
<td style="text-align:right;">
0.0
</td>
<td style="text-align:right;">
0.33
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.17
</td>
<td style="text-align:right;">
0.29
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.11
</td>
<td style="text-align:right;">
0.93
</td>
<td style="text-align:left;">
poun_base_0
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
Podocnemis unifilis
</td>
<td style="text-align:left;">
base
</td>
<td style="text-align:right;">
0.1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
10.74
</td>
<td style="text-align:right;">
0.1
</td>
<td style="text-align:right;">
0.33
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.17
</td>
<td style="text-align:right;">
0.29
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.11
</td>
<td style="text-align:right;">
0.93
</td>
<td style="text-align:left;">
poun_base_0.1
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
Podocnemis unifilis
</td>
<td style="text-align:left;">
base
</td>
<td style="text-align:right;">
0.2
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
10.74
</td>
<td style="text-align:right;">
0.2
</td>
<td style="text-align:right;">
0.33
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.17
</td>
<td style="text-align:right;">
0.29
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.11
</td>
<td style="text-align:right;">
0.93
</td>
<td style="text-align:left;">
poun_base_0.2
</td>
<td style="text-align:right;">
NA
</td>
</tr>
</tbody>
</table>
<p>Each row can be easily converted for use in a stage-based matrix
population model. The following code shows how the third row becomes a
stage-based matrix.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">stage_names</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"a1"</span>, <span class="st">"a2"</span>, <span class="st">"a3"</span>, <span class="st">"a4"</span>,</span>
<span>                   <span class="st">"b1"</span>, <span class="st">"b2"</span>, <span class="st">"b3"</span>, <span class="st">"b4"</span>,</span>
<span>                   <span class="st">"c1"</span>, <span class="st">"c2"</span>, <span class="st">"c3"</span>, <span class="st">"c4"</span>,</span>
<span>                   <span class="st">"d1"</span>, <span class="st">"d2"</span>, <span class="st">"d3"</span>, <span class="st">"d4"</span><span class="op">)</span></span>
<span><span class="va">vpop</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">dt</span><span class="op">[</span><span class="fl">3</span> , <span class="va">stage_names</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">pop_mat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="va">vpop</span>, byrow <span class="op">=</span> <span class="cn">TRUE</span>, ncol<span class="op">=</span><span class="fl">4</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dimnames.html" class="external-link">dimnames</a></span><span class="op">(</span><span class="va">pop_mat</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"_1"</span>, <span class="st">"_2"</span>, <span class="st">"_3"</span>, <span class="st">"_4"</span><span class="op">)</span>,</span>
<span>                            <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span> <span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">"c"</span>, <span class="st">"d"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
The matrix should look like this:
<table class="table table" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead><tr>
<th style="text-align:left;">
</th>
<th style="text-align:left;">
a
</th>
<th style="text-align:left;">
b
</th>
<th style="text-align:left;">
c
</th>
<th style="text-align:left;">
d
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;font-weight: bold;">
_1
</td>
<td style="text-align:left;">
0.000000
</td>
<td style="text-align:left;">
0.000000
</td>
<td style="text-align:left;">
0.000000
</td>
<td style="text-align:left;">
10.741500
</td>
</tr>
<tr>
<td style="text-align:left;font-weight: bold;">
_2
</td>
<td style="text-align:left;">
0.200000
</td>
<td style="text-align:left;">
0.333333
</td>
<td style="text-align:left;">
0.000000
</td>
<td style="text-align:left;">
0.000000
</td>
</tr>
<tr>
<td style="text-align:left;font-weight: bold;">
_3
</td>
<td style="text-align:left;">
0.000000
</td>
<td style="text-align:left;">
0.166667
</td>
<td style="text-align:left;">
0.285714
</td>
<td style="text-align:left;">
0.000000
</td>
</tr>
<tr>
<td style="text-align:left;font-weight: bold;">
_4
</td>
<td style="text-align:left;">
0.000000
</td>
<td style="text-align:left;">
0.000000
</td>
<td style="text-align:left;">
0.114286
</td>
<td style="text-align:left;">
0.930000
</td>
</tr>
</tbody>
</table>
<p>This matrix includes information of population growth, survival and
reproduction.</p>
<p>We can show the different matrix components (growth, survival and
reproduction) by converting to the structure recommended by <a href="https://compadre-db.org/" class="external-link">COM(P)ADRE</a>. COM(P)ADRE is a global
scale online repository for matrix population models (MPMs) and metadata
on plants, animals, bacteria, viruses, algae, and fungi. There are two R
packages developed specifically to work with these MPMs: <a href="https://jonesor.github.io/Rcompadre/index.html" class="external-link">Rcompadre</a> and
<a href="https://jonesor.github.io/Rage/" class="external-link">Rage</a> (Jones et. al. 2022,
<a href="https://doi.org/10.1111/2041-210X.13792" class="external-link uri">https://doi.org/10.1111/2041-210X.13792</a>). For more
details see: <a href="https://cran.r-project.org/web/packages/Rage/vignettes/a01_GettingStarted.html" class="external-link uri">https://cran.r-project.org/web/packages/Rage/vignettes/a01_GettingStarted.html</a></p>
<p>The code below creates a compadre database object from the matrix at
line 3 of the data.frame “dt”, created earlier by the function
“pop01_param_poun”.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">meta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>idNum <span class="op">=</span> <span class="fl">3</span>, </span>
<span>                   SpeciesAccepted <span class="op">=</span> <span class="va">dt</span><span class="op">[</span><span class="fl">3</span> , <span class="st">'species'</span><span class="op">]</span>,</span>
<span>                   type <span class="op">=</span> <span class="va">dt</span><span class="op">[</span><span class="fl">3</span> , <span class="st">'type'</span><span class="op">]</span>, </span>
<span>                   first_year <span class="op">=</span> <span class="va">dt</span><span class="op">[</span><span class="fl">3</span> , <span class="st">'first_year'</span><span class="op">]</span><span class="op">)</span> </span>
<span><span class="va">stageInfo</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    MatrixClassOrganized <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"active"</span>, <span class="fl">4</span><span class="op">)</span>,</span>
<span>    MatrixClassAuthor <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"eggs/hatchling"</span>, <span class="st">"juvenile-early"</span>, <span class="st">"juvenile-late"</span>, <span class="st">"adult"</span><span class="op">)</span></span>
<span>  <span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># Simple full A matrix</span></span>
<span><span class="va">l_pop_mat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>mpm <span class="op">=</span> <span class="va">pop_mat</span><span class="op">)</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu">Rcompadre</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/Rcompadre/man/cdb_build_cdb.html" class="external-link">cdb_build_cdb</a></span><span class="op">(</span>mat_a <span class="op">=</span> <span class="va">l_pop_mat</span>, metadata <span class="op">=</span> <span class="va">meta</span>, stages <span class="op">=</span> <span class="va">stageInfo</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Seperate into U (growth/survival), F (sexual reproduction), C (clonal reproduction)</span></span>
<span><span class="va">mat_u1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">dt</span><span class="op">[</span><span class="fl">3</span>, <span class="st">'a1'</span><span class="op">]</span>, <span class="va">dt</span><span class="op">[</span><span class="fl">3</span>, <span class="st">'a2'</span><span class="op">]</span>, <span class="va">dt</span><span class="op">[</span><span class="fl">3</span>, <span class="st">'a3'</span><span class="op">]</span>, <span class="fl">0</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">dt</span><span class="op">[</span><span class="fl">3</span>, <span class="st">'b1'</span><span class="op">]</span>, <span class="va">dt</span><span class="op">[</span><span class="fl">3</span>, <span class="st">'b2'</span><span class="op">]</span>, <span class="va">dt</span><span class="op">[</span><span class="fl">3</span>, <span class="st">'b3'</span><span class="op">]</span>, <span class="va">dt</span><span class="op">[</span><span class="fl">3</span>, <span class="st">'b4'</span><span class="op">]</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">dt</span><span class="op">[</span><span class="fl">3</span>, <span class="st">'c1'</span><span class="op">]</span>, <span class="va">dt</span><span class="op">[</span><span class="fl">3</span>, <span class="st">'c2'</span><span class="op">]</span>, <span class="va">dt</span><span class="op">[</span><span class="fl">3</span>, <span class="st">'c3'</span><span class="op">]</span>, <span class="va">dt</span><span class="op">[</span><span class="fl">3</span>, <span class="st">'c4'</span><span class="op">]</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">dt</span><span class="op">[</span><span class="fl">3</span>, <span class="st">'d1'</span><span class="op">]</span>, <span class="va">dt</span><span class="op">[</span><span class="fl">3</span>, <span class="st">'d2'</span><span class="op">]</span>, <span class="va">dt</span><span class="op">[</span><span class="fl">3</span>, <span class="st">'d3'</span><span class="op">]</span>, <span class="va">dt</span><span class="op">[</span><span class="fl">3</span>, <span class="st">'d4'</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">mat_f1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.0</span>, <span class="fl">0.0</span>, <span class="fl">0.0</span>, <span class="va">dt</span><span class="op">[</span><span class="fl">3</span>, <span class="st">'a4'</span><span class="op">]</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.0</span>, <span class="fl">0.0</span>, <span class="fl">0.0</span>, <span class="fl">0.0</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.0</span>, <span class="fl">0.0</span>, <span class="fl">0.0</span>, <span class="fl">0.0</span><span class="op">)</span>, </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.0</span>, <span class="fl">0.0</span>, <span class="fl">0.0</span>, <span class="fl">0.0</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">mat_c1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.0</span>, <span class="fl">0.0</span>, <span class="fl">0.0</span>, <span class="fl">0.0</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.0</span>, <span class="fl">0.0</span>, <span class="fl">0.0</span>, <span class="fl">0.0</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.0</span>, <span class="fl">0.0</span>, <span class="fl">0.0</span>, <span class="fl">0.0</span><span class="op">)</span>, </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.0</span>, <span class="fl">0.0</span>, <span class="fl">0.0</span>, <span class="fl">0.0</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">l_u</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>m_u <span class="op">=</span> <span class="va">mat_u1</span><span class="op">)</span></span>
<span><span class="va">l_f</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>m_f <span class="op">=</span> <span class="va">mat_f1</span><span class="op">)</span></span>
<span><span class="va">l_c</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>m_c <span class="op">=</span> <span class="va">mat_c1</span><span class="op">)</span></span>
<span></span>
<span><span class="va">my_comadre</span> <span class="op">&lt;-</span> <span class="fu">Rcompadre</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/Rcompadre/man/cdb_build_cdb.html" class="external-link">cdb_build_cdb</a></span><span class="op">(</span></span>
<span>  mat_u <span class="op">=</span> <span class="va">l_u</span>, mat_f <span class="op">=</span> <span class="va">l_f</span>, mat_c <span class="op">=</span> <span class="va">l_c</span>,</span>
<span>  metadata <span class="op">=</span> <span class="va">meta</span>, </span>
<span>  stages <span class="op">=</span> <span class="va">stageInfo</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Now we have the growth/survival and reproduciton matrixes, we can
obtain many useful age related life history traits using functions in
the package Rage (<a href="https://jonesor.github.io/Rage/" class="external-link uri">https://jonesor.github.io/Rage/</a>).</p>
<p>The code below provides examples of generation time and life
expectancy.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># the time required for a population to </span></span>
<span><span class="co"># increase by a factor of R0 (the net reproductive rate)</span></span>
<span><span class="fu">Rage</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/Rage/man/gen_time.html" class="external-link">gen_time</a></span><span class="op">(</span>matU <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/Rcompadre/man/CompadreMatrixMethods.html" class="external-link">matU</a></span><span class="op">(</span><span class="va">my_comadre</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/pkg/Rcompadre/man/CompadreMatrixMethods.html" class="external-link">matF</a></span><span class="op">(</span><span class="va">my_comadre</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="co"># 17.15</span></span>
<span><span class="co">#&gt; [1] 17.15455</span></span>
<span><span class="co"># the average parent-offspring age difference # 16.22</span></span>
<span><span class="fu">Rage</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/Rage/man/gen_time.html" class="external-link">gen_time</a></span><span class="op">(</span>matU <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/Rcompadre/man/CompadreMatrixMethods.html" class="external-link">matU</a></span><span class="op">(</span><span class="va">my_comadre</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/pkg/Rcompadre/man/CompadreMatrixMethods.html" class="external-link">matF</a></span><span class="op">(</span><span class="va">my_comadre</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, method <span class="op">=</span> <span class="st">"age_diff"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 16.22243</span></span>
<span><span class="co"># expected age at reproduction for a cohort 5.69</span></span>
<span><span class="fu">Rage</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/Rage/man/gen_time.html" class="external-link">gen_time</a></span><span class="op">(</span>matU <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/Rcompadre/man/CompadreMatrixMethods.html" class="external-link">matU</a></span><span class="op">(</span><span class="va">my_comadre</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/pkg/Rcompadre/man/CompadreMatrixMethods.html" class="external-link">matF</a></span><span class="op">(</span><span class="va">my_comadre</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, method <span class="op">=</span> <span class="st">"cohort"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 5.696541</span></span>
<span></span>
<span><span class="fu">Rage</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/Rage/man/life_expect.html" class="external-link">life_expect_mean</a></span><span class="op">(</span>matU <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/Rcompadre/man/CompadreMatrixMethods.html" class="external-link">matU</a></span><span class="op">(</span><span class="va">my_comadre</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, start <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1.484286</span></span>
<span><span class="co"># Add life expectancies of all stages to get overall longevity - 21.87 years</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fu">Rage</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/Rage/man/life_expect.html" class="external-link">life_expect_mean</a></span><span class="op">(</span><span class="fu">Rcompadre</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/Rcompadre/man/CompadreMatrixMethods.html" class="external-link">matU</a></span><span class="op">(</span><span class="va">my_comadre</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, start <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 21.87715</span></span></code></pre></div>
<p>We can also plot the life cycle diagram.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">Rage</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/Rage/man/plot_life_cycle.html" class="external-link">plot_life_cycle</a></span><span class="op">(</span>matA <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/Rcompadre/man/CompadreMatrixMethods.html" class="external-link">matA</a></span><span class="op">(</span><span class="va">my_comadre</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, </span>
<span>                stages <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"eggs/hatchling"</span>, <span class="st">"juvenile-early"</span>, <span class="st">"juvenile-late"</span>, <span class="st">"adult"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="grViz html-widget html-fill-item" id="htmlwidget-ac96cb3ee4656e2e9ec3" style="width:700px;height:432.632880098888px;"></div>
<script type="application/json" data-for="htmlwidget-ac96cb3ee4656e2e9ec3">{"x":{"diagram":"\ndigraph {\n  {\n    graph[overlap=false];\n    rank=same;\n    node [shape= egg , fontsize= 12 ]; \"eggs/hatchling\" -> \"juvenile-early\" -> \"juvenile-late\" -> \"adult\" [style=invis] \n  } ordering=out\n  x [style=invis]\n  x -> { \"eggs/hatchling\" -> \"juvenile-early\" -> \"juvenile-late\" -> \"adult\" [style=invis] } [style=invis] \"eggs/hatchling\" -> \"juvenile-early\"[minlen=3,fontsize=10,color=grey,xlabel=\" 0.2\"]\n\"juvenile-early\" -> \"juvenile-early\"[minlen=0,fontsize=10,color=grey,xlabel=\" 0.333\"]\n\"juvenile-early\" -> \"juvenile-late\"[minlen=3,fontsize=10,color=grey,xlabel=\" 0.167\"]\n\"juvenile-late\" -> \"juvenile-late\"[minlen=0,fontsize=10,color=grey,xlabel=\" 0.286\"]\n\"juvenile-late\" -> \"adult\"[minlen=3,fontsize=10,color=grey,xlabel=\" 0.114\"]\n\"adult\" -> \"eggs/hatchling\"[minlen=-9,fontsize=10,color=grey,xlabel=\" 10.742\"]\n\"adult\" -> \"adult\"[minlen=0,fontsize=10,color=grey,xlabel=\" 0.93\"]\n labelloc=\"t\";\n  label=\"  \"\n}","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>
</div>
<div class="section level3">
<h3 id="projection-models-">Projection models.<a class="anchor" aria-label="anchor" href="#projection-models-"></a>
</h3>
<p>Here stage-based matrix population models are run using functions
available in packages <a href="https://doi.org/10.18637/jss.v022.i11" class="external-link">popbio</a>, <a href="https://cran.r-project.org/web/packages/popdemo/vignettes/popdemo.html" class="external-link">popdemo</a>
and <a href="https://jonesor.github.io/Rage/" class="external-link">Rage</a>. A series of life
history metrics are then calculated from the matrix population models
using functions available in Rage (Jones et. al. 2022).</p>
<div class="section level4">
<h4 id="deterministic-models">Deterministic models<a class="anchor" aria-label="anchor" href="#deterministic-models"></a>
</h4>
<p>Deterministic models have no density-dependence and the population
matrix is constant (i.e., vital rates do not change overtime (timestep
to timestep)). Below the function “pop03_doproj” calculates
deterministic projections and summaries for the population matrixes
stored in the data.frame “dt”, created previously with the function
“pop01_param_poun” (see Norris et. al. 2019 for full details and
justification of the life stages used).</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># project</span></span>
<span><span class="va">dout</span> <span class="op">&lt;-</span> <span class="fu">plyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/plyr/man/ddply.html" class="external-link">ddply</a></span><span class="op">(</span><span class="va">dt</span>, </span>
<span>                    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"species"</span>, <span class="st">"type"</span>, <span class="st">"first_year"</span>,<span class="st">"akey"</span><span class="op">)</span>, .fun <span class="op">=</span>  <span class="va">pop03_doproj</span><span class="op">)</span></span>
<span><span class="va">dout</span><span class="op">$</span><span class="va">arun</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span></span>
<span><span class="co"># Model summaries</span></span>
<span><span class="va">model_sum</span> <span class="op">&lt;-</span> <span class="va">dout</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">species</span>, <span class="va">type</span>, <span class="va">first_year</span>, <span class="va">lambda</span>, </span>
<span>           <span class="va">gen_time</span>, <span class="va">gen_age_diff</span>, <span class="va">life_exp</span>, <span class="va">life_exp_adult</span>, <span class="va">mat_prob</span>, <span class="va">eggs_to_adult</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/plyr/man/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>fem_t0 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">fem_t0</span><span class="op">)</span>, </span>
<span>            fem_min <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">fem</span><span class="op">)</span>,</span>
<span>              fem_max <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">fem</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">lambda_n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">model_sum</span><span class="op">$</span><span class="va">lambda</span><span class="op">)</span><span class="op">)</span> <span class="co"># 50</span></span>
<span><span class="va">lambda_mean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">model_sum</span><span class="op">$</span><span class="va">lambda</span><span class="op">)</span> <span class="co"># 0.9432</span></span>
<span><span class="va">lambda_sd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">model_sum</span><span class="op">$</span><span class="va">lambda</span><span class="op">)</span> <span class="co"># 0.1506</span></span>
<span><span class="va">lambda_min</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">model_sum</span><span class="op">$</span><span class="va">lambda</span><span class="op">)</span> <span class="co"># 0.4659</span></span>
<span><span class="va">lambda_max</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">model_sum</span><span class="op">$</span><span class="va">lambda</span><span class="op">)</span> <span class="co"># 1.1539</span></span>
<span></span>
<span><span class="co"># Export for future use</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">saveRDS</a></span><span class="op">(</span><span class="va">dout</span>, <span class="st">"inst/other/dout.rds"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="stochastic-models">Stochastic models<a class="anchor" aria-label="anchor" href="#stochastic-models"></a>
</h4>
<p>Stochastic matrix population models use matrices to represent
population dynamics, with the key feature of incorporating randomness or
variability in vital rates (e.g. survival). This randomness reflects the
inherent uncertainty and fluctuations in real-world systems, making
these models more realistic than their deterministic counterparts. Here
matrix switching is used to reflect variation in yearling survival over
time.<br>
The matrix changes randomly at each iteration of the model to
incorporate random environmental and/or demographic variation. In the
code below, the function “pop03_doproj_stoch” calculates stochastic
projections and summaries for the population matrixes stored in the
data.frame “dt”, created previously with the function
“pop01_param_poun”.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Stochastic</span></span>
<span><span class="co">#data frame with runs for processing</span></span>
<span><span class="co">#nruns &lt;- 100 # 100 gives same pattern as 50</span></span>
<span><span class="va">nruns</span> <span class="op">&lt;-</span> <span class="fl">50</span></span>
<span><span class="va">dt_stoch</span> <span class="op">&lt;-</span> <span class="va">dt</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">dt</span><span class="op">)</span><span class="op">)</span>, <span class="va">nruns</span><span class="op">)</span>, <span class="op">]</span></span>
<span><span class="va">dt_stoch</span><span class="op">$</span><span class="va">arun</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">nruns</span>, each <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">dt</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># Approx 90 - 120 minutes. 1,212,000 rows. </span></span>
<span><span class="co"># Projections quick. Summaries across stochastic matrices slow.</span></span>
<span><span class="co"># 19:41 - 21:42</span></span>
<span><span class="va">dout_stoch</span> <span class="op">&lt;-</span> <span class="fu">plyr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/plyr/man/ddply.html" class="external-link">ddply</a></span><span class="op">(</span><span class="va">dt_stoch</span>, </span>
<span>                    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"arun"</span>, <span class="st">"species"</span>, <span class="st">"type"</span>, <span class="st">"first_year"</span>,<span class="st">"akey"</span><span class="op">)</span>, </span>
<span>                    .fun <span class="op">=</span>  <span class="va">pop03_doproj_stoch</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">dout_stoch</span><span class="op">$</span><span class="va">model</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">dout_stoch</span><span class="op">$</span><span class="va">type</span><span class="op">)</span></span>
<span><span class="va">model_sum_stoch</span> <span class="op">&lt;-</span> <span class="va">dout_stoch</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">species</span>, <span class="va">type</span>, <span class="va">model</span>, <span class="va">first_year</span>, <span class="va">lambda</span>, <span class="va">lambda_q75</span>,</span>
<span>           <span class="va">gen_time</span>, <span class="va">gen_age_diff_med</span>, <span class="va">gen_age_q75</span>, </span>
<span>           <span class="va">life_exp_med</span>, <span class="va">life_exp_adult_med</span>, <span class="va">mat_prob_med</span>, <span class="va">mat_prob_q75</span>, </span>
<span>           <span class="va">eggs_to_adult_med</span>, <span class="va">eggs_to_adult_q75</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/plyr/man/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>acount <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span>, </span>
<span>            fem_t0 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">fem_t0</span><span class="op">)</span>, </span>
<span>            fem_min <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">fem</span><span class="op">)</span>,</span>
<span>              fem_max <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">fem</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co"># Export for future use</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">saveRDS</a></span><span class="op">(</span><span class="va">dout_stoch</span>, <span class="st">"inst/other/dout_stoch.rds"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="combine-results-">Combine results.<a class="anchor" aria-label="anchor" href="#combine-results-"></a>
</h4>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dout</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="st">"inst/other/dout.rds"</span><span class="op">)</span></span>
<span><span class="va">dout_stoch</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="st">"inst/other/dout_stoch.rds"</span><span class="op">)</span></span>
<span><span class="co"># Combine data for plotting</span></span>
<span><span class="va">dout_all</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">dout</span> <span class="op">|&gt;</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">arun</span>, <span class="va">model</span>, <span class="va">type</span>, <span class="va">first_year</span>, </span>
<span>                                                   <span class="va">akey</span>, <span class="va">ayear</span>, </span>
<span>                                                   <span class="va">lambda</span>, <span class="va">gen_time</span>, <span class="va">gen_age_diff</span>, </span>
<span>                                                   <span class="va">life_exp</span>, <span class="va">life_exp_adult</span>, </span>
<span>                                                   <span class="va">mat_prob</span>, <span class="va">eggs_to_adult</span>,</span>
<span>                                            <span class="va">fem</span>, <span class="va">fem_t0</span>, <span class="va">fem_diff</span>, <span class="va">change50_flag</span>, </span>
<span>                                            <span class="va">change30_flag</span>,</span>
<span>                                            <span class="va">double_flag</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>                               <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>lambda_lcl <span class="op">=</span> <span class="cn">NA</span>, lambda_ucl <span class="op">=</span> <span class="cn">NA</span>, </span>
<span>                                             lambda_sd <span class="op">=</span> <span class="cn">NA</span>,  gen_sd <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span>, </span>
<span>                             <span class="va">dout_stoch</span> <span class="op">|&gt;</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">arun</span>, <span class="va">model</span>, <span class="va">type</span>, <span class="va">first_year</span>, </span>
<span>                                                         <span class="va">akey</span>, <span class="va">ayear</span>, </span>
<span>                                                         <span class="va">lambda</span>, <span class="va">lambda_lcl</span>, <span class="va">lambda_ucl</span>, </span>
<span>                                                         <span class="va">lambda_sd</span>, <span class="va">gen_time</span>, <span class="va">gen_sd</span>, </span>
<span>                                                         <span class="va">gen_age_diff</span>, </span>
<span>                                                   <span class="va">life_exp</span>, <span class="va">life_exp_adult</span>, </span>
<span>                                                   <span class="va">mat_prob</span>, <span class="va">eggs_to_adult</span>,</span>
<span>                                            <span class="va">fem</span>, <span class="va">fem_t0</span>, <span class="va">fem_diff</span>, <span class="va">change50_flag</span>, </span>
<span>                                            <span class="va">change30_flag</span>,</span>
<span>                                            <span class="va">double_flag</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># Limit adult female number to maximum (20% above original for baseline).</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">dout_all</span><span class="op">$</span><span class="va">fem</span><span class="op">)</span></span>
<span><span class="co">#    Min.  1st Qu.   Median     Mean  3rd Qu.     Max. </span></span>
<span><span class="co">#       0        0        1     1389       11 16560701</span></span>
<span><span class="va">dout_all</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">dout_all</span><span class="op">$</span><span class="va">fem</span> <span class="op">&gt;</span> <span class="va">ceiling_threshold</span><span class="op">)</span>, <span class="st">'fem'</span> <span class="op">]</span> <span class="op">&lt;-</span> <span class="va">ceiling_threshold</span></span>
<span><span class="co"># summary(dout_all$fem)</span></span>
<span><span class="co">#     Min.   1st Qu.    Median      Mean   3rd Qu.      Max. </span></span>
<span><span class="co"># 0.000000  0.005763  1.485889  4.522590 11.240127 12.000000 </span></span>
<span> </span>
<span><span class="co"># Factors in right order</span></span>
<span><span class="va">dout_all</span><span class="op">$</span><span class="va">modelf</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="va">dout_all</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">dout_all</span><span class="op">$</span><span class="va">model</span><span class="op">==</span><span class="st">"Stochastic uniform"</span><span class="op">)</span> , <span class="st">'modelf'</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">2</span></span>
<span><span class="va">dout_all</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">dout_all</span><span class="op">$</span><span class="va">model</span><span class="op">==</span><span class="st">"Stochastic equal"</span><span class="op">)</span> , <span class="st">'modelf'</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">3</span></span>
<span><span class="va">dout_all</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">dout_all</span><span class="op">$</span><span class="va">model</span><span class="op">==</span><span class="st">"Stochastic bad x2"</span><span class="op">)</span> , <span class="st">'modelf'</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">4</span></span>
<span><span class="va">dout_all</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">dout_all</span><span class="op">$</span><span class="va">model</span><span class="op">==</span><span class="st">"Stochastic bad x4"</span><span class="op">)</span> , <span class="st">'modelf'</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">5</span></span>
<span><span class="va">dout_all</span><span class="op">$</span><span class="va">modelf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">dout_all</span><span class="op">$</span><span class="va">modelf</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="va">dout_all</span><span class="op">$</span><span class="va">modelf</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Deterministic"</span>, <span class="st">"Stochastic uniform"</span>, </span>
<span>                          <span class="st">"Stochastic equal"</span>, <span class="st">"Stochastic bad x2"</span>, </span>
<span>                          <span class="st">"Stochastic bad x4"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">dout_all</span><span class="op">$</span><span class="va">modelf</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">dout_all</span><span class="op">$</span><span class="va">modelf</span><span class="op">)</span></span>
<span><span class="va">dout_all</span><span class="op">$</span><span class="va">typef</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="va">dout_all</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">dout_all</span><span class="op">$</span><span class="va">type</span><span class="op">==</span><span class="st">"female-hunt 2.5%"</span><span class="op">)</span> , <span class="st">'typef'</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">2</span></span>
<span><span class="va">dout_all</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">dout_all</span><span class="op">$</span><span class="va">type</span><span class="op">==</span><span class="st">"female-hunt 5%"</span><span class="op">)</span> , <span class="st">'typef'</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">3</span></span>
<span><span class="va">dout_all</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">dout_all</span><span class="op">$</span><span class="va">type</span><span class="op">==</span><span class="st">"female-hunt 10%"</span><span class="op">)</span> , <span class="st">'typef'</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">4</span></span>
<span><span class="va">dout_all</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">dout_all</span><span class="op">$</span><span class="va">type</span><span class="op">==</span><span class="st">"female-hunt 25%"</span><span class="op">)</span> , <span class="st">'typef'</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">5</span></span>
<span><span class="va">dout_all</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">dout_all</span><span class="op">$</span><span class="va">type</span><span class="op">==</span><span class="st">"female-hunt 50%"</span><span class="op">)</span> , <span class="st">'typef'</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">6</span></span>
<span><span class="va">dout_all</span><span class="op">$</span><span class="va">typef</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">dout_all</span><span class="op">$</span><span class="va">typef</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="va">dout_all</span><span class="op">$</span><span class="va">typef</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"base"</span>, <span class="st">"female-hunt 2.5%"</span>, </span>
<span>                            <span class="st">"female-hunt 5%"</span>,</span>
<span>                          <span class="st">"female-hunt 10%"</span>, <span class="st">"female-hunt 25%"</span>, </span>
<span>                          <span class="st">"female-hunt 50%"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">dout_all</span><span class="op">$</span><span class="va">typef</span><span class="op">)</span></span>
<span><span class="co"># first year survival</span></span>
<span><span class="va">dout_all</span><span class="op">$</span><span class="va">first_yearf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">dout_all</span><span class="op">$</span><span class="va">first_year</span><span class="op">)</span></span>
<span><span class="va">fylev</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"first-year\nsurvival\n"</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.9</span>, by <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="va">dout_all</span><span class="op">$</span><span class="va">first_yearf</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">fylev</span></span>
<span><span class="co"># Export for future use. 17/6/2024 - 1,218,060 rows 21 columns.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">saveRDS</a></span><span class="op">(</span><span class="va">dout_all</span>, <span class="st">"inst/other/dout_all.rds"</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="model-lookup">Model lookup<a class="anchor" aria-label="anchor" href="#model-lookup"></a>
</h3>
<p>Derive model summaries to link with conservation management
scenarios. The conservation management scenarios are used to help inform
IUCN Red List and Green Status assessments.</p>
<ul>
<li><p>Red List guidelines<br>
“For example, upper and lower quartiles of the projected magnitude of
the future reduction (i.e., reductions with 25% and 75% probability) may
be considered to represent a plausible range of projected reduction.”
(IUCN, 2024 - section 4.5.2, p38).</p></li>
<li><p>Green Status Presence<br>
Present when population is at least 1 as measured by lower quartile
population.</p></li>
<li><p>Green Status Viability<br>
Viable when not declining: lower quartile of lambda &gt;= 1. A species
is considered viable in a spatial unit if application of the Regional
Red List Guidelines to the population in the spatial unit would result
in a categorization of ‘Least Concern’ OR ‘Near Threatened and Not
Declining’.</p></li>
<li><p>Green Status Functional<br>
Functional when population lower quartile is 10 times base
level.</p></li>
</ul>
<p>The code below adds projection results to each of the matrix
population models.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># load data. 14 August 2024 with 1218060 rows and 26 columns</span></span>
<span><span class="va">dout_all</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="st">"inst/other/dout_all.rds"</span><span class="op">)</span></span>
<span><span class="co"># 101 years, 5 model types (deterministic with 6060, stochastic with 6060 * 50), </span></span>
<span><span class="co"># 6 harvest levels, 10 first year levels</span></span>
<span><span class="co"># Make unique model ID. boot mean is same as mean (at least to 6 decimal places)</span></span>
<span><span class="co"># 300 projection models.</span></span>
<span><span class="va">model_ref</span> <span class="op">&lt;-</span> <span class="va">dout_all</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">akey</span>, <span class="va">modelf</span>, <span class="va">typef</span>, <span class="va">first_year</span>, <span class="va">arun</span>, <span class="va">lambda</span>, <span class="va">gen_time</span>, </span>
<span>           <span class="va">gen_age_diff</span>, <span class="va">life_exp</span>, <span class="va">life_exp_adult</span>, <span class="va">eggs_to_adult</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/plyr/man/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>yc <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">ayear</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">akey</span>, <span class="va">modelf</span>, <span class="va">typef</span>, <span class="va">first_year</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/plyr/man/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>count_runs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">arun</span><span class="op">)</span><span class="op">)</span>, </span>
<span>            count_years <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">yc</span><span class="op">)</span>,</span>
<span>            lambda_mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">lambda</span><span class="op">)</span>, </span>
<span>            lambda_min <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">lambda</span><span class="op">)</span>, </span>
<span>            lambda_max <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">lambda</span><span class="op">)</span>, </span>
<span>            lambda_sd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">lambda</span><span class="op">)</span>,</span>
<span>            lambda_boot_lcl <span class="op">=</span> <span class="fu">Hmisc</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/Hmisc/man/smean.sd.html" class="external-link">smean.cl.boot</a></span><span class="op">(</span><span class="va">lambda</span><span class="op">)</span><span class="op">[</span><span class="st">"Lower"</span><span class="op">]</span>,</span>
<span>            lambda_boot_ucl <span class="op">=</span> <span class="fu">Hmisc</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/Hmisc/man/smean.sd.html" class="external-link">smean.cl.boot</a></span><span class="op">(</span><span class="va">lambda</span><span class="op">)</span><span class="op">[</span><span class="st">"Upper"</span><span class="op">]</span>, </span>
<span>            lambda_q25 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">lambda</span>, probs <span class="op">=</span> <span class="fl">0.25</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>            lambda_q75 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">lambda</span>, probs <span class="op">=</span> <span class="fl">0.75</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, </span>
<span>            gen_mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">gen_time</span><span class="op">)</span>, </span>
<span>            gen_med <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html" class="external-link">median</a></span><span class="op">(</span><span class="va">gen_time</span><span class="op">)</span>,</span>
<span>            gen_min <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">gen_time</span><span class="op">)</span>, </span>
<span>            gen_max <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">gen_time</span><span class="op">)</span>, </span>
<span>            gen_sd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">gen_time</span><span class="op">)</span>,</span>
<span>            gen_boot_lcl <span class="op">=</span> <span class="fu">Hmisc</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/Hmisc/man/smean.sd.html" class="external-link">smean.cl.boot</a></span><span class="op">(</span><span class="va">gen_time</span><span class="op">)</span><span class="op">[</span><span class="st">"Lower"</span><span class="op">]</span>,</span>
<span>            gen_boot_ucl <span class="op">=</span> <span class="fu">Hmisc</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/Hmisc/man/smean.sd.html" class="external-link">smean.cl.boot</a></span><span class="op">(</span><span class="va">gen_time</span><span class="op">)</span><span class="op">[</span><span class="st">"Upper"</span><span class="op">]</span>, </span>
<span>            gen_q25 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">gen_time</span>, probs <span class="op">=</span> <span class="fl">0.25</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>            gen_q75 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">gen_time</span>, probs <span class="op">=</span> <span class="fl">0.75</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, </span>
<span>            gen_age_mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">gen_age_diff</span><span class="op">)</span>, </span>
<span>            gen_age_med <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html" class="external-link">median</a></span><span class="op">(</span><span class="va">gen_age_diff</span><span class="op">)</span>,</span>
<span>            gen_age_min <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">gen_age_diff</span><span class="op">)</span>, </span>
<span>            gen_age_max <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">gen_age_diff</span><span class="op">)</span>, </span>
<span>            gen_age_sd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">gen_age_diff</span><span class="op">)</span>,</span>
<span>            gen_age_boot_lcl <span class="op">=</span> <span class="fu">Hmisc</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/Hmisc/man/smean.sd.html" class="external-link">smean.cl.boot</a></span><span class="op">(</span><span class="va">gen_age_diff</span><span class="op">)</span><span class="op">[</span><span class="st">"Lower"</span><span class="op">]</span>,</span>
<span>            gen_age_boot_ucl <span class="op">=</span> <span class="fu">Hmisc</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/Hmisc/man/smean.sd.html" class="external-link">smean.cl.boot</a></span><span class="op">(</span><span class="va">gen_age_diff</span><span class="op">)</span><span class="op">[</span><span class="st">"Upper"</span><span class="op">]</span>, </span>
<span>            gen_age_q25 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">gen_age_diff</span>, probs <span class="op">=</span> <span class="fl">0.25</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>            gen_age_q75 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">gen_age_diff</span>, probs <span class="op">=</span> <span class="fl">0.75</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, </span>
<span>            life_exp_mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">life_exp</span><span class="op">)</span>, </span>
<span>            life_exp_med <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html" class="external-link">median</a></span><span class="op">(</span><span class="va">life_exp</span><span class="op">)</span>,</span>
<span>            life_exp_min <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">life_exp</span><span class="op">)</span>, </span>
<span>            life_exp_max <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">life_exp</span><span class="op">)</span>, </span>
<span>            life_exp_sd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">life_exp</span><span class="op">)</span>,</span>
<span>            life_exp_boot_lcl <span class="op">=</span> <span class="fu">Hmisc</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/Hmisc/man/smean.sd.html" class="external-link">smean.cl.boot</a></span><span class="op">(</span><span class="va">life_exp</span><span class="op">)</span><span class="op">[</span><span class="st">"Lower"</span><span class="op">]</span>,</span>
<span>            life_exp_boot_ucl <span class="op">=</span> <span class="fu">Hmisc</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/Hmisc/man/smean.sd.html" class="external-link">smean.cl.boot</a></span><span class="op">(</span><span class="va">life_exp</span><span class="op">)</span><span class="op">[</span><span class="st">"Upper"</span><span class="op">]</span>, </span>
<span>            life_exp_q25 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">life_exp</span>, probs <span class="op">=</span> <span class="fl">0.25</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>            life_exp_q75 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">life_exp</span>, probs <span class="op">=</span> <span class="fl">0.75</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, </span>
<span>            life_exp_adult_mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">life_exp_adult</span><span class="op">)</span>, </span>
<span>            life_exp_adult_med <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html" class="external-link">median</a></span><span class="op">(</span><span class="va">life_exp_adult</span><span class="op">)</span>,</span>
<span>            life_exp_adult_min <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">life_exp_adult</span><span class="op">)</span>, </span>
<span>            life_exp_adult_max <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">life_exp_adult</span><span class="op">)</span>, </span>
<span>            life_exp_adult_sd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">life_exp_adult</span><span class="op">)</span>,</span>
<span>            life_exp_adult_boot_lcl <span class="op">=</span> <span class="fu">Hmisc</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/Hmisc/man/smean.sd.html" class="external-link">smean.cl.boot</a></span><span class="op">(</span><span class="va">life_exp_adult</span><span class="op">)</span><span class="op">[</span><span class="st">"Lower"</span><span class="op">]</span>,</span>
<span>            life_exp_adult_boot_ucl <span class="op">=</span> <span class="fu">Hmisc</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/Hmisc/man/smean.sd.html" class="external-link">smean.cl.boot</a></span><span class="op">(</span><span class="va">life_exp_adult</span><span class="op">)</span><span class="op">[</span><span class="st">"Upper"</span><span class="op">]</span>, </span>
<span>            life_exp_adult_q25 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">life_exp_adult</span>, probs <span class="op">=</span> <span class="fl">0.25</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>            life_exp_adult_q75 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">life_exp_adult</span>, probs <span class="op">=</span> <span class="fl">0.75</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>            eggs_to_adult_mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">eggs_to_adult</span><span class="op">)</span>, </span>
<span>            eggs_to_adult_med <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html" class="external-link">median</a></span><span class="op">(</span><span class="va">eggs_to_adult</span><span class="op">)</span>,</span>
<span>            eggs_to_adult_min <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">eggs_to_adult</span><span class="op">)</span>, </span>
<span>            eggs_to_adult_max <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">eggs_to_adult</span><span class="op">)</span>, </span>
<span>            eggs_to_adult_sd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">eggs_to_adult</span><span class="op">)</span>,</span>
<span>            eggs_to_adult_boot_lcl <span class="op">=</span> <span class="fu">Hmisc</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/Hmisc/man/smean.sd.html" class="external-link">smean.cl.boot</a></span><span class="op">(</span><span class="va">eggs_to_adult</span><span class="op">)</span><span class="op">[</span><span class="st">"Lower"</span><span class="op">]</span>,</span>
<span>            eggs_to_adult_boot_ucl <span class="op">=</span> <span class="fu">Hmisc</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/Hmisc/man/smean.sd.html" class="external-link">smean.cl.boot</a></span><span class="op">(</span><span class="va">eggs_to_adult</span><span class="op">)</span><span class="op">[</span><span class="st">"Upper"</span><span class="op">]</span>, </span>
<span>            eggs_to_adult_q25 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">eggs_to_adult</span>, probs <span class="op">=</span> <span class="fl">0.25</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>            eggs_to_adult_q75 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">eggs_to_adult</span>, probs <span class="op">=</span> <span class="fl">0.75</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>            </span>
<span>            <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/plyr/man/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">typef</span>, <span class="va">first_year</span>, <span class="va">modelf</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/plyr/man/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>modelid <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">akey</span>, <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">modelf</span><span class="op">)</span>, sep <span class="op">=</span> <span class="st">"_"</span><span class="op">)</span>, </span>
<span>         modelkey <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/row_number.html" class="external-link">row_number</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/relocate.html" class="external-link">relocate</a></span><span class="op">(</span><span class="va">modelkey</span>, <span class="va">modelid</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Estimates of generation time for summary.</span></span>
<span><span class="co"># Bienvenu and Legendre (2015) https://doi.org/10.1086%2F681104 - </span></span>
<span><span class="co"># defined as the mean age of mothers at birth.</span></span>
<span><span class="co"># IUCN definition - is the mean age at which a cohort of individuals produce offspring.</span></span>
<span><span class="va">gen_mean</span> <span class="op">&lt;-</span> <span class="va">model_ref</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">lambda_q75</span> <span class="op">&gt;=</span> <span class="fl">1</span>, <span class="va">first_year</span> <span class="op">&lt;</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">gen_age_mean</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">gen_median</span> <span class="op">&lt;-</span> <span class="va">model_ref</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">lambda_q75</span> <span class="op">&gt;=</span> <span class="fl">1</span>, <span class="va">first_year</span> <span class="op">&lt;</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">gen_age_mean</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html" class="external-link">median</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">gen_q25</span> <span class="op">&lt;-</span> <span class="va">model_ref</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">lambda_q75</span> <span class="op">&gt;=</span> <span class="fl">1</span>, <span class="va">first_year</span> <span class="op">&lt;</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">gen_age_mean</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span>probs <span class="op">=</span> <span class="fl">0.25</span><span class="op">)</span></span>
<span><span class="va">gen_q75</span> <span class="op">&lt;-</span> <span class="va">model_ref</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">lambda_q75</span> <span class="op">&gt;=</span> <span class="fl">1</span>, <span class="va">first_year</span> <span class="op">&lt;</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">gen_age_mean</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span>probs <span class="op">=</span> <span class="fl">0.75</span><span class="op">)</span></span>
<span><span class="va">gen_3</span> <span class="op">&lt;-</span> <span class="va">gen_mean</span> <span class="op">*</span> <span class="fl">3</span></span>
<span><span class="va">gen_3_q25</span> <span class="op">&lt;-</span> <span class="va">gen_q25</span> <span class="op">*</span> <span class="fl">3</span></span>
<span><span class="va">gen_3_q75</span> <span class="op">&lt;-</span> <span class="va">gen_q75</span> <span class="op">*</span> <span class="fl">3</span></span>
<span></span>
<span><span class="co"># Add population changes.</span></span>
<span><span class="va">model_ref2</span> <span class="op">&lt;-</span> <span class="va">model_ref</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">dout_all</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">ayear</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">ceiling</a></span><span class="op">(</span><span class="va">gen_3</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">ceiling</a></span><span class="op">(</span><span class="va">gen_3_q25</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">ceiling</a></span><span class="op">(</span><span class="va">gen_3_q75</span><span class="op">)</span>, <span class="fl">100</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">akey</span>, <span class="va">modelf</span>, <span class="va">typef</span>, <span class="va">first_year</span>, <span class="va">ayear</span>, <span class="va">arun</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/plyr/man/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>fem_t0 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">fem_t0</span><span class="op">)</span>, </span>
<span>            femnew <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">fem</span><span class="op">)</span>,</span>
<span>            femnew_diff <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">fem_diff</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">akey</span>, <span class="va">modelf</span>, <span class="va">typef</span>, <span class="va">first_year</span>, <span class="va">ayear</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/plyr/man/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>fem_t0 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">fem_t0</span><span class="op">)</span>, </span>
<span>            fem <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">femnew</span><span class="op">)</span>,</span>
<span>            fem_sd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">femnew</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, </span>
<span>            fem_q25 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">femnew</span>, probs <span class="op">=</span> <span class="fl">0.25</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>            fem_q75 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">femnew</span>, probs <span class="op">=</span> <span class="fl">0.75</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>            fem_diff <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">femnew_diff</span><span class="op">)</span>, </span>
<span>            fem_diff_sd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">femnew_diff</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, </span>
<span>            fem_diff_q25 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">femnew_diff</span>, probs <span class="op">=</span> <span class="fl">0.25</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>            fem_diff_q75 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">femnew_diff</span>, probs <span class="op">=</span> <span class="fl">0.75</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/plyr/man/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>ayear <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"t"</span>, <span class="va">ayear</span>, sep<span class="op">=</span><span class="st">""</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html" class="external-link">pivot_wider</a></span><span class="op">(</span>names_from <span class="op">=</span> <span class="va">ayear</span>, </span>
<span>               values_from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">fem</span>, <span class="va">fem_sd</span>, <span class="va">fem_q25</span>, <span class="va">fem_q75</span>, <span class="va">fem_diff</span>, </span>
<span>                               <span class="va">fem_diff_sd</span>, <span class="va">fem_diff_q25</span>, <span class="va">fem_diff_q75</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/plyr/man/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">typef</span>, <span class="va">first_year</span>, <span class="va">modelf</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Add time to change by 50% and 30% </span></span>
<span><span class="va">model_ref3</span> <span class="op">&lt;-</span> <span class="va">model_ref2</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">dout_all</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">change50_flag</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">akey</span>, <span class="va">modelf</span>, <span class="va">typef</span>, <span class="va">first_year</span>, <span class="va">arun</span>, </span>
<span>          <span class="va">change50_flag</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/plyr/man/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>acount <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span>, </span>
<span>            change50_yf <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">ayear</span><span class="op">)</span>, </span>
<span>            change50_yl <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">ayear</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">akey</span>, <span class="va">modelf</span>, <span class="va">typef</span>, <span class="va">first_year</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/plyr/man/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>change50_ymean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">floor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">change50_yf</span><span class="op">)</span><span class="op">)</span>, </span>
<span>            change50_ysd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">change50_yf</span><span class="op">)</span>, </span>
<span>            change50_yq25 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">floor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">change50_yf</span>, probs <span class="op">=</span> <span class="fl">0.25</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>,</span>
<span>            change50_yq75 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">floor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">change50_yf</span>, probs <span class="op">=</span> <span class="fl">0.75</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>   <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">dout_all</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">change30_flag</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">akey</span>, <span class="va">modelf</span>, <span class="va">typef</span>, <span class="va">first_year</span>, <span class="va">arun</span>, </span>
<span>          <span class="va">change30_flag</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/plyr/man/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>acount <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span>, </span>
<span>            change30_yf <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">ayear</span><span class="op">)</span>, </span>
<span>            change30_yl <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">ayear</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">akey</span>, <span class="va">modelf</span>, <span class="va">typef</span>, <span class="va">first_year</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/plyr/man/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>change30_ymean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">floor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">change30_yf</span><span class="op">)</span><span class="op">)</span>, </span>
<span>            change30_ysd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">change30_yf</span><span class="op">)</span>, </span>
<span>            change30_yq25 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">floor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">change30_yf</span>, probs <span class="op">=</span> <span class="fl">0.25</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>,</span>
<span>            change30_yq75 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">floor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">change30_yf</span>, probs <span class="op">=</span> <span class="fl">0.75</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>   <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Export for future use</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">saveRDS</a></span><span class="op">(</span><span class="va">model_ref3</span>, <span class="st">"inst/other/model_lookup.rds"</span><span class="op">)</span> </span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/write.table.html" class="external-link">write.csv2</a></span><span class="op">(</span><span class="va">model_ref3</span>, <span class="st">"inst/other/model_lookup.csv"</span>, row.names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> </span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="scenario-integration">Scenario integration<a class="anchor" aria-label="anchor" href="#scenario-integration"></a>
</h2>
<div class="section level3">
<h3 id="section-objective">Section objective<a class="anchor" aria-label="anchor" href="#section-objective"></a>
</h3>
<p>Integrate point locations and population projections with
conservation management scenarios.</p>
<p>Specifically:</p>
<ul>
<li>Join points with conservation management scenarios and population
projections.</li>
<li>Generate data used for summaries.</li>
<li>Make summaries.</li>
</ul>
</div>
<div class="section level3">
<h3 id="join-with-scenarios">Join with scenarios<a class="anchor" aria-label="anchor" href="#join-with-scenarios"></a>
</h3>
<p>Load data: points, projection model lookup table and scenarios.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># point data</span></span>
<span><span class="co"># load points made previously in prep_river_points.Rmd. RIVORD 1 to 5. </span></span>
<span><span class="co"># Cropped to basins from Norris et. al. 2019.</span></span>
<span><span class="va">ffr_1a5_poun_points_3395</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">st_read</a></span><span class="op">(</span>dsn <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"vector/poun_river_points_v2.gpkg"</span>, package<span class="op">=</span><span class="st">"TACAR"</span><span class="op">)</span>,</span>
<span>                                    layer <span class="op">=</span> <span class="st">"ffr_1a5_poun_points_3395"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Reading layer `ffr_1a5_poun_points_3395' from data source </span></span>
<span><span class="co">#&gt;   `/home/runner/work/_temp/Library/TACAR/vector/poun_river_points_v2.gpkg' </span></span>
<span><span class="co">#&gt;   using driver `GPKG'</span></span>
<span><span class="co">#&gt; Simple feature collection with 353437 features and 52 fields</span></span>
<span><span class="co">#&gt; Geometry type: POINT</span></span>
<span><span class="co">#&gt; Dimension:     XY</span></span>
<span><span class="co">#&gt; Bounding box:  xmin: -8839379 ymin: -2162255 xmax: -4738776 ymax: 1094857</span></span>
<span><span class="co">#&gt; Projected CRS: WGS 84 / World Mercator</span></span>
<span><span class="co">#HydroBasin codes made previously in prep_river_points.Rmd.</span></span>
<span><span class="va">ffr_1a5_poun_points_hb_3395</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">st_read</a></span><span class="op">(</span>dsn <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"vector/poun_river_points_hb_v1.gpkg"</span>, package<span class="op">=</span><span class="st">"TACAR"</span><span class="op">)</span>,</span>
<span>                                    layer <span class="op">=</span> <span class="st">"ffr_1a5_poun_points_hb_3395"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Reading layer `ffr_1a5_poun_points_hb_3395' from data source </span></span>
<span><span class="co">#&gt;   `/home/runner/work/_temp/Library/TACAR/vector/poun_river_points_hb_v1.gpkg' </span></span>
<span><span class="co">#&gt;   using driver `GPKG'</span></span>
<span><span class="co">#&gt; Simple feature collection with 353437 features and 17 fields</span></span>
<span><span class="co">#&gt; Geometry type: POINT</span></span>
<span><span class="co">#&gt; Dimension:     XY</span></span>
<span><span class="co">#&gt; Bounding box:  xmin: -8839379 ymin: -2162255 xmax: -4738776 ymax: 1094857</span></span>
<span><span class="co">#&gt; Projected CRS: WGS 84 / World Mercator</span></span>
<span><span class="co"># quicker joining just data.</span></span>
<span><span class="co">#geom column name</span></span>
<span><span class="va">geocol</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">ffr_1a5_poun_points_hb_3395</span>,<span class="st">"sf_column"</span><span class="op">)</span></span>
<span><span class="co"># join</span></span>
<span><span class="va">ffr_1a5_poun_points_3395</span> <span class="op">&lt;-</span> <span class="va">ffr_1a5_poun_points_3395</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">ffr_1a5_poun_points_hb_3395</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>              <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">!</span><span class="fu">tidyselect</span><span class="fu">::</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/all_of.html" class="external-link">all_of</a></span><span class="op">(</span><span class="va">geocol</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Joining with `by = join_by(REACH_ID, BASIN_FLAG, SUBBASIN_FLAG, reach_id_point,</span></span>
<span><span class="co">#&gt; HYBAS_ID_l3, PFAF_ID_l3, SUB_AREA_l3, HYBAS_ID_l4, PFAF_ID_l4, SUB_AREA_l4,</span></span>
<span><span class="co">#&gt; HYBAS_ID_l5, PFAF_ID_l5, SUB_AREA_l5)`</span></span>
<span><span class="co"># projections and scenarios</span></span>
<span><span class="co"># model_lookup has results from 300 population projection models created previously</span></span>
<span><span class="va">model_lookup</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"other/model_lookup.rds"</span>, package <span class="op">=</span> <span class="st">"TACAR"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># actions has scenarios for IUCN Red List and Green Status evaluations, </span></span>
<span><span class="co"># with link to river points and associated projection models</span></span>
<span><span class="va">actions</span> <span class="op">&lt;-</span> <span class="fu">readxl</span><span class="fu">::</span><span class="fu"><a href="https://readxl.tidyverse.org/reference/read_excel.html" class="external-link">read_excel</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"other/Podocnemis_conservation_actions.xlsx"</span>, package <span class="op">=</span> <span class="st">"TACAR"</span><span class="op">)</span>, </span>
<span>                      sheet <span class="op">=</span> <span class="st">"scenario_parameters"</span>, .name_repair <span class="op">=</span> <span class="st">"universal"</span><span class="op">)</span></span>
<span><span class="co">#&gt; New names:</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">•</span> `Podocnemis modelling scenario` -&gt; `Podocnemis.modelling.scenario`</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">•</span> `Population perturbation parameter changes (BAU).` -&gt;</span></span>
<span><span class="co">#&gt;   `Population.perturbation.parameter.changes..BAU..`</span></span></code></pre></div>
<p>Now join.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Here with 3 scenarios for each river point:-</span></span>
<span><span class="co"># modelkey pessimistic, BAU, optimistic.</span></span>
<span><span class="co">### 1060311 rows 6/8/2024</span></span>
<span><span class="va">scenario_ffr_res</span> <span class="op">&lt;-</span> <span class="va">ffr_1a5_poun_points_3395</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="co">#filter(subbasn == "Trombetas") |&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/plyr/man/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Protected <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span><span class="va">All</span> <span class="op">==</span> <span class="fl">1</span>, <span class="st">"yes"</span>, <span class="st">"no"</span><span class="op">)</span>, </span>
<span>         Protected_cat <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span><span class="va">Indigenous</span> <span class="op">==</span> <span class="fl">1</span> <span class="op">~</span> <span class="st">"TI"</span>, </span>
<span>                                   <span class="va">Strict</span> <span class="op">==</span> <span class="fl">1</span> <span class="op">~</span> <span class="st">"SP"</span>, </span>
<span>                                   <span class="va">myuse</span> <span class="op">==</span> <span class="fl">1</span> <span class="op">~</span> <span class="st">"SU"</span>, </span>
<span>                                   .default <span class="op">=</span> <span class="st">"no"</span></span>
<span>                                   <span class="op">)</span>, </span>
<span>         Accessible <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span><span class="va">access_new</span> <span class="op">==</span> <span class="fl">0</span>, <span class="st">"no"</span>, <span class="st">"yes"</span><span class="op">)</span>, </span>
<span>         Free_flowing <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span><span class="va">CSI</span> <span class="op">&gt;=</span> <span class="fl">0.92</span>, <span class="st">"yes"</span>, <span class="st">"no"</span><span class="op">)</span></span>
<span>         <span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span> </span>
<span>           <span class="va">actions</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">Podocnemis.modelling.scenario</span> <span class="op">==</span> <span class="st">"Protection"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">starts_with</a></span><span class="op">(</span><span class="st">"modelkey"</span><span class="op">)</span>, names_to <span class="op">=</span> <span class="st">"model_name"</span>, </span>
<span>               values_to <span class="op">=</span> <span class="st">"modelkey"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">model_lookup</span>, by <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/join_by.html" class="external-link">join_by</a></span><span class="op">(</span><span class="va">modelkey</span> <span class="op">==</span> <span class="va">modelkey</span><span class="op">)</span> </span>
<span>            <span class="op">)</span>, </span>
<span>  by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Protected"</span> <span class="op">=</span> <span class="st">"Protected"</span>, <span class="st">"Protected_cat"</span> <span class="op">=</span> <span class="st">"Protected_cat"</span>, </span>
<span>         <span class="st">"Accessible"</span> <span class="op">=</span> <span class="st">"Accessible"</span>, </span>
<span>         <span class="st">"Free_flowing"</span> <span class="op">=</span> <span class="st">"Free_flowing"</span><span class="op">)</span>, </span>
<span>  relationship <span class="op">=</span> <span class="st">"many-to-many"</span></span>
<span>           <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">lambda_mean</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="co"># where points do not overlap new basins</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/plyr/man/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>flag_b <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">BASIN_NAME</span>, <span class="va">subbasin</span>, sep<span class="op">=</span><span class="st">"_"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># should be zero rows if join worked. </span></span>
<span><span class="va">test_join</span> <span class="op">&lt;-</span> <span class="va">scenario_ffr_res</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">lambda_mean</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co"># This file is used in testmap. 1060311 rows, 169 columns 24/8/2024.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">saveRDS</a></span><span class="op">(</span><span class="va">scenario_ffr_res</span>, <span class="st">"inst/other/scenario_res_ffr1a5.rds"</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="results">Results<a class="anchor" aria-label="anchor" href="#results"></a>
</h2>
<div class="section level3">
<h3 id="section-objective-1">Section objective<a class="anchor" aria-label="anchor" href="#section-objective-1"></a>
</h3>
<p>Present key findings from the analysis.</p>
</div>
<div class="section level3">
<h3 id="load-and-summarise-data-">Load and summarise data.<a class="anchor" aria-label="anchor" href="#load-and-summarise-data-"></a>
</h3>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fin</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"other/scenario_res_ffr1a5.rds"</span>, package <span class="op">=</span> <span class="st">"TACAR"</span><span class="op">)</span></span>
<span><span class="va">scenario_ffr_res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="va">fin</span><span class="op">)</span></span></code></pre></div>
<p>Make factors and other useful values.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Make factors</span></span>
<span><span class="va">scenario_ffr_res</span><span class="op">$</span><span class="va">model_namef</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">scenario_ffr_res</span><span class="op">$</span><span class="va">model_name</span><span class="op">)</span></span>
<span><span class="co">#levels(scenario_ffr_res$model_namef)</span></span>
<span><span class="va">scenario_ffr_res</span><span class="op">$</span><span class="va">model_namef</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/relevel.html" class="external-link">relevel</a></span><span class="op">(</span><span class="va">scenario_ffr_res</span><span class="op">$</span><span class="va">model_namef</span>, ref <span class="op">=</span> <span class="st">"modelkey_pessimistic"</span><span class="op">)</span></span>
<span><span class="va">scenario_ffr_res</span><span class="op">$</span><span class="va">modelidf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">scenario_ffr_res</span><span class="op">$</span><span class="va">modelid</span><span class="op">)</span></span>
<span><span class="co"># scale value range</span></span>
<span><span class="va">diff_min</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">scenario_ffr_res</span><span class="op">$</span><span class="va">fem_diff_t45</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">diff_max</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">scenario_ffr_res</span><span class="op">$</span><span class="va">fem_diff_t45</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>A little test.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Test with smaller subset.</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="va">scenario_ffr_res</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">COUNTRY</span> <span class="op">==</span> <span class="st">"French Guiana"</span><span class="op">)</span></span>
<span><span class="co"># Unique groups</span></span>
<span><span class="va">df</span> <span class="op">|&gt;</span></span>
<span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">COUNTRY</span>, <span class="va">BASIN_NAME</span>, <span class="va">reach_id_point</span>,</span>
<span>         <span class="va">model_name</span>, <span class="va">modelkey</span>, <span class="va">modelid</span>, <span class="va">typef</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>acount <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html" class="external-link">desc</a></span><span class="op">(</span><span class="va">acount</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; `summarise()` has grouped output by 'COUNTRY', 'BASIN_NAME', 'reach_id_point',</span></span>
<span><span class="co">#&gt; 'model_name', 'modelkey', 'modelid'. You can override using the `.groups`</span></span>
<span><span class="co">#&gt; argument.</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 9,894 × 8</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># Groups:   COUNTRY, BASIN_NAME, reach_id_point, model_name, modelkey, modelid</span></span></span>
<span><span class="co"><span style="color: #949494;">#&gt; #   [9,894]</span></span></span>
<span><span class="co">#&gt;    COUNTRY    BASIN_NAME reach_id_point model_name modelkey modelid typef acount</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> French Gu… Coastal N… 60111852_1     modelkey_…      112 poun_f… fema…      1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> French Gu… Coastal N… 60111852_1     modelkey_…       62 poun_f… fema…      1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> French Gu… Coastal N… 60111852_1     modelkey_…      107 poun_f… fema…      1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> French Gu… Coastal N… 60111852_2     modelkey_…      112 poun_f… fema…      1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> French Gu… Coastal N… 60111852_2     modelkey_…       62 poun_f… fema…      1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> French Gu… Coastal N… 60111852_2     modelkey_…      107 poun_f… fema…      1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> French Gu… Coastal N… 60111852_3     modelkey_…      112 poun_f… fema…      1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> French Gu… Coastal N… 60111852_3     modelkey_…       62 poun_f… fema…      1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> French Gu… Coastal N… 60111852_3     modelkey_…      107 poun_f… fema…      1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> French Gu… Coastal N… 60111852_4     modelkey_…      112 poun_f… fema…      1</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 9,884 more rows</span></span></span>
<span></span>
<span><span class="co"># Frequency distribution of river points among scenarios.</span></span>
<span><span class="va">df</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>modelidf <span class="op">=</span> <span class="fu">forcats</span><span class="fu">::</span><span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_reorder.html" class="external-link">fct_reorder</a></span><span class="op">(</span><span class="va">modelidf</span>, <span class="va">lambda_mean</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">modelkey</span>, <span class="va">modelidf</span>, <span class="va">model_namef</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html" class="external-link">tally</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html" class="external-link">pivot_wider</a></span><span class="op">(</span>names_from <span class="op">=</span> <span class="va">model_namef</span>, </span>
<span>                     values_from <span class="op">=</span> <span class="va">n</span>, values_fill <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 5 × 5</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># Groups:   modelkey, modelidf [5]</span></span></span>
<span><span class="co">#&gt;   modelkey modelidf        modelkey_pessimistic modelkey_BAU modelkey_optimistic</span></span>
<span><span class="co">#&gt;      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>                          <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>               <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>       12 poun_base_0.2_2                 <span style="text-decoration: underline;">1</span>216         <span style="text-decoration: underline;">1</span>216                <span style="text-decoration: underline;">1</span>250</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>       62 poun_female-hu…                    0           34                 765</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>      107 poun_female-hu…                  799         <span style="text-decoration: underline;">1</span>283                   0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>      112 poun_female-hu…                    0          765                <span style="text-decoration: underline;">1</span>283</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span>      157 poun_female-hu…                 <span style="text-decoration: underline;">1</span>283            0                   0</span></span></code></pre></div>
<p>Summarise population changes.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_country_basin</span> <span class="op">&lt;-</span> <span class="va">scenario_ffr_res</span> <span class="op">|&gt;</span> </span>
<span>  <span class="co">#dplyr::filter(BASIN_NAME == "Coastal North") |&gt; # track why have 1 Coastal South</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">flag_exclude</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>modelidf <span class="op">=</span> <span class="fu">forcats</span><span class="fu">::</span><span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_reorder.html" class="external-link">fct_reorder</a></span><span class="op">(</span><span class="va">modelidf</span>, <span class="va">lambda_mean</span><span class="op">)</span>, </span>
<span>                basin_country <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">BASIN_NAME</span>, <span class="va">COUNTRY</span>, sep <span class="op">=</span><span class="st">"\n"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">basin_country</span>, <span class="va">COUNTRY</span>, <span class="va">BASIN_NAME</span>, </span>
<span>                  <span class="va">model_namef</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>acount <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span>, </span>
<span>                   tot_t0 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">fem_t0</span><span class="op">)</span>,</span>
<span>                   diff_t35 <span class="op">=</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">fem_t35</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">fem_t0</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">fem_t0</span><span class="op">)</span>,</span>
<span>                   diff_t41 <span class="op">=</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">fem_t41</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">fem_t0</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">fem_t0</span><span class="op">)</span>, </span>
<span>                   diff_t45 <span class="op">=</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">fem_t45</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">fem_t0</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">fem_t0</span><span class="op">)</span> </span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">acount</span> <span class="op">&gt;</span> <span class="fl">21</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">starts_with</a></span><span class="op">(</span><span class="st">"diff_"</span><span class="op">)</span>, names_to <span class="op">=</span> <span class="st">"gen_t3"</span>, </span>
<span>                      values_to <span class="op">=</span> <span class="st">"fem_diff"</span><span class="op">)</span></span>
<span><span class="co"># Make weights. Below does not help.</span></span>
<span><span class="co">#df_country_basin$wt &lt;- df_country_basin$acount / sum(df_country_basin$acount)</span></span>
<span><span class="co"># make sure to avoid these</span></span>
<span><span class="co"># |&gt; </span></span>
<span><span class="co">#  filter(length_river &gt; 21) |&gt; </span></span>
<span> <span class="co"># droplevels() |&gt;</span></span>
<span></span>
<span><span class="co"># Now get interquartile range for all.</span></span>
<span> <span class="va">df_iqr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html" class="external-link">median</a></span><span class="op">(</span><span class="va">df_country_basin</span><span class="op">$</span><span class="va">fem_diff</span><span class="op">)</span>,</span>
<span>    ymin <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">df_country_basin</span><span class="op">$</span><span class="va">fem_diff</span>, probs <span class="op">=</span> <span class="fl">0.25</span><span class="op">)</span>,</span>
<span>    ymax <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">df_country_basin</span><span class="op">$</span><span class="va">fem_diff</span>, probs <span class="op">=</span> <span class="fl">0.75</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co"># Weighted interqantile range</span></span>
<span><span class="va">mean_wt</span> <span class="op">&lt;-</span> <span class="fu">Hmisc</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/Hmisc/man/wtd.stats.html" class="external-link">wtd.mean</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">df_country_basin</span><span class="op">$</span><span class="va">fem_diff</span>, </span>
<span>                              w <span class="op">=</span> <span class="va">df_country_basin</span><span class="op">$</span><span class="va">acount</span><span class="op">)</span></span>
<span><span class="va">iqr_wt_25</span> <span class="op">&lt;-</span> <span class="fu">Hmisc</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/Hmisc/man/wtd.stats.html" class="external-link">wtd.quantile</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">df_country_basin</span><span class="op">$</span><span class="va">fem_diff</span>, </span>
<span>                              w <span class="op">=</span> <span class="va">df_country_basin</span><span class="op">$</span><span class="va">acount</span>, probs <span class="op">=</span> <span class="fl">0.25</span><span class="op">)</span></span>
<span><span class="va">iqr_wt_75</span> <span class="op">&lt;-</span> <span class="fu">Hmisc</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/Hmisc/man/wtd.stats.html" class="external-link">wtd.quantile</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">df_country_basin</span><span class="op">$</span><span class="va">fem_diff</span>, </span>
<span>                              w <span class="op">=</span> <span class="va">df_country_basin</span><span class="op">$</span><span class="va">acount</span>, probs <span class="op">=</span> <span class="fl">0.75</span><span class="op">)</span></span>
<span><span class="va">change_value</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">mean_wt</span><span class="op">)</span> <span class="op">*</span> <span class="fl">100</span>, <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">change_q25</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">iqr_wt_25</span><span class="op">)</span> <span class="op">*</span> <span class="fl">100</span>, <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">change_q75</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">iqr_wt_75</span><span class="op">)</span> <span class="op">*</span> <span class="fl">100</span>, <span class="fl">1</span><span class="op">)</span></span>
<span><span class="co"># Total river lengths</span></span>
<span><span class="va">river_tot</span> <span class="op">&lt;-</span> <span class="va">df_country_basin</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">basin_country</span>, <span class="va">COUNTRY</span>, <span class="va">BASIN_NAME</span>, <span class="va">acount</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>atmp <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>length_label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="op">(</span><span class="va">acount</span> <span class="op">/</span> <span class="fl">1000</span><span class="op">)</span>, <span class="fl">1</span><span class="op">)</span>, <span class="st">"K km"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># How much does the Brazilian Amazon represent? Pull values.</span></span>
<span><span class="va">river_totkm</span> <span class="op">&lt;-</span> <span class="va">river_tot</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">acount</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="op">)</span> </span>
<span><span class="va">river_amazon_brazil</span> <span class="op">&lt;-</span>   <span class="va">river_tot</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">COUNTRY</span> <span class="op">==</span> <span class="st">"Brazil"</span>, <span class="va">BASIN_NAME</span> <span class="op">==</span> <span class="st">"Amazon"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/droplevels.html" class="external-link">droplevels</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">acount</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="op">)</span> </span>
<span><span class="va">river_amazon_brazil_prop</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="op">(</span><span class="op">(</span><span class="va">river_amazon_brazil</span> <span class="op">/</span> <span class="va">river_totkm</span><span class="op">)</span> <span class="op">*</span> <span class="fl">100</span><span class="op">)</span>, <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="findings">Findings<a class="anchor" aria-label="anchor" href="#findings"></a>
</h3>
<ul>
<li><p>Within 3 generations, the adult female population is predicted to
decline by 50.6% in the future (25 and 75% quantile range: 64.7 - 34.4 %
decline).</p></li>
<li>
<p>This is a conservative (best-case) estimate.<br>
Endangered (A3bd), is threfore a precautionary IUCN Red List
assessment.</p>
<ul>
<li>Important threats are not included (e.g. land use change Zalles et.
al. 2021).</li>
<li>Losses are potentially buffered by an overly generous 20% ceiling to
increases in unaccesible/unhunted populations.</li>
<li>Population projections use the earliest likely breeding age. The age
at first reproduction was set to 5 years (Norris et. al. 2019).</li>
<li>Hunting of adult females was limited to 10% per year in the most
pessimistic scenarios.</li>
<li>Hunting accessibility was limited to a distance of 48 km from
locations with a human population density of 5 or more people per
km<sup>2</sup>. This will underestimate impacts associated with threats
such as large scale harvest around urban areas (Chaves et. al. 2021,
Tregidgo et. al. 2017).</li>
</ul>
</li>
</ul>
<div class="section level4">
<h4 id="plot-to-check">Plot to check<a class="anchor" aria-label="anchor" href="#plot-to-check"></a>
</h4>
<ul>
<li>Compare population changes across basin-country combinations.<br>
Presenting the results visually can fascilitate a more detailed
understanding of the patterns in the results.</li>
</ul>
<p>The code below makes a figure with population change on the x-axis
and basin-country combination on the y-axis. This avoids sqashing long
names, which would happen if the basin-country combinations were plotted
along the x-axis.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Define function to calculate IQR at given quantiles</span></span>
<span><span class="va">iqr</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">z</span>, <span class="va">lower</span> <span class="op">=</span> <span class="fl">0.25</span>, <span class="va">upper</span> <span class="op">=</span> <span class="fl">0.75</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html" class="external-link">median</a></span><span class="op">(</span><span class="va">z</span><span class="op">)</span>,</span>
<span>    ymin <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">z</span>, <span class="va">lower</span><span class="op">)</span>,</span>
<span>    ymax <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">z</span>, <span class="va">upper</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">stat_sum_df</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">fun</span>, <span class="va">geom</span><span class="op">=</span><span class="st">"crossbar"</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/stat_summary.html" class="external-link">stat_summary</a></span><span class="op">(</span>fun.data <span class="op">=</span> <span class="va">fun</span>, colour <span class="op">=</span> <span class="st">"black"</span>, geom <span class="op">=</span> <span class="va">geom</span>, width <span class="op">=</span> <span class="fl">0.4</span>, <span class="va">...</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Plot points summarised with standard IQR</span></span>
<span><span class="va">fig_basin_country</span> <span class="op">&lt;-</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">df_country_basin</span>, </span>
<span>                mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">basin_country</span>, y <span class="op">=</span> <span class="va">fem_diff</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="co">#stat_summary(fun.data = iqr) </span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">0</span>, colour <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html" class="external-link">annotate</a></span><span class="op">(</span>xmin<span class="op">=</span><span class="op">-</span><span class="cn">Inf</span>, xmax<span class="op">=</span><span class="cn">Inf</span>, </span>
<span>           ymin <span class="op">=</span> <span class="va">iqr_wt_25</span>, ymax <span class="op">=</span> <span class="va">iqr_wt_75</span>,</span>
<span>            fill<span class="op">=</span><span class="st">"grey80"</span>, geom <span class="op">=</span> <span class="st">'rect'</span>, alpha<span class="op">=</span><span class="fl">0.4</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="va">mean_wt</span>, colour <span class="op">=</span> <span class="st">"black"</span>, </span>
<span>             linetype <span class="op">=</span> <span class="st">"dashed"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">stat_sum_df</span><span class="op">(</span><span class="st">"iqr"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_jitter.html" class="external-link">geom_jitter</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>shape <span class="op">=</span> <span class="va">gen_t3</span>, colour <span class="op">=</span> <span class="va">model_namef</span><span class="op">)</span>, </span>
<span>              width <span class="op">=</span> <span class="fl">0.1</span>, height <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">diff_min</span>, <span class="va">diff_max</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html" class="external-link">geom_label</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">river_tot</span>, </span>
<span>             <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">basin_country</span>, y <span class="op">=</span> <span class="fl">0.2</span>, label <span class="op">=</span> <span class="va">length_label</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_flip.html" class="external-link">coord_flip</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_shape.html" class="external-link">scale_shape</a></span><span class="op">(</span>name<span class="op">=</span><span class="st">"three\ngenerations"</span>,</span>
<span>                         breaks<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"diff_t35"</span>, <span class="st">"diff_t41"</span>, <span class="st">"diff_t45"</span><span class="op">)</span>,</span>
<span>                         labels<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"35 Y"</span>, <span class="st">"41 Y"</span>, <span class="st">"45 Y"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_colour_viridis_d</a></span><span class="op">(</span>name<span class="op">=</span><span class="st">"threat-impact\nscenario"</span>,</span>
<span>                         breaks<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"modelkey_pessimistic"</span>, <span class="st">"modelkey_BAU"</span>, <span class="st">"modelkey_optimistic"</span><span class="op">)</span>,</span>
<span>                         labels<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"pessimistic"</span>, <span class="st">"BAU"</span>, <span class="st">"optimistic"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>y <span class="op">=</span> <span class="st">"Population change"</span>, x <span class="op">=</span> <span class="st">""</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Export for future use</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/grDevices/png.html" class="external-link">png</a></span><span class="op">(</span>file <span class="op">=</span> <span class="st">"vignettes/fig_basin_country_summary.png"</span>, bg <span class="op">=</span> <span class="st">"transparent"</span>, </span>
<span>    type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"cairo"</span><span class="op">)</span>, </span>
<span>    width <span class="op">=</span> <span class="fl">8</span>, height <span class="op">=</span> <span class="fl">8</span>, units <span class="op">=</span> <span class="st">"in"</span>, res<span class="op">=</span><span class="fl">600</span><span class="op">)</span></span>
<span><span class="va">fig_basin_country</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/invisible.html" class="external-link">invisible</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/grDevices/dev.html" class="external-link">dev.off</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Check plot.</p>
<p><img src="fig_basin_country_summary.png" width="80%" height="80%"></p>
<p>In the above figure a population change of “-0.5” is 50% loss. The
shaded shapes show predicted population changes for each basin-country
combination. The labels to the right show river lengths in thousands of
kilometers (e.g. “22.2 K km” is 22,200 kilometers). The vertical dashed
line shows the overall mean value, and the verticle grey shaded area is
the interquartile range (IQR - 25% and 75% quantile values). As the
basin-country combinations cover different sized areas, estimates of
overall mean and IQR are obtained using calculations weighted by the
river length.</p>
<p>Within each basin-country combination, the horizontal black crossbars
show the median and interquartile range of projection scenarios. These
scenarios represent the impact of threats (e.g. hunting) across three
generations. The impact of threats ranges from most severe
(“pessimistic”), Business-as-usual (“BAU”), to least severe
(“optimistic”). Generation length was estimated from stage-based matrix
population models (Bienvenu &amp; Legendre, 2015). The scenario results
include the mean (41 year), and the interquartile range of three
generations (35 and 45 year, 25% and 75% quantile values respectively).
Generation length estimation follows the IUCN definition: “Generation
length is the average age of parents of the current cohort (i.e.,
newborn individuals in the population). Generation length therefore
reflects the turnover rate of breeding individuals in a population…..
Where generation length varies under threat, such as the exploitation of
fishes, the more natural, i.e. pre-disturbance, generation length should
be used.” (IUCN 2001, 2012).</p>
<p>The Amazon Basin in Brazil represents the largest proportion of
rivers (51.2%). Considering the spatial variation in both threats and
population genetics, it would probably be useful to include the Amazon
Basin seperated into major basins (e.g. HydroBasin level 4 - Madeira,
Negro, etc). But the summaries presented here provide a general overview
and enable robust assessment of the results. Additionally, the overall
patterns do not change if the Amazon basin is seperated further.</p>
</div>
<div class="section level4">
<h4 id="by-country">By country<a class="anchor" aria-label="anchor" href="#by-country"></a>
</h4>
<p>The code below generates a summary by country using the same data as
the basin-country comparison. For each country the mean and
interquartile range is calculated, with estimates weighted by the river
length within each basin.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_river_couuntry</span> <span class="op">&lt;-</span> <span class="va">river_tot</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">COUNTRY</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/plyr/man/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>river_km <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">acount</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span><span class="va">df_wtd_country</span> <span class="op">&lt;-</span> <span class="va">df_country_basin</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">COUNTRY</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/plyr/man/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>mean_wtd <span class="op">=</span> <span class="fu">Hmisc</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/Hmisc/man/wtd.stats.html" class="external-link">wtd.mean</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">fem_diff</span>, w <span class="op">=</span> <span class="va">acount</span><span class="op">)</span>, </span>
<span>            iqr_wtd_25 <span class="op">=</span> <span class="fu">Hmisc</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/Hmisc/man/wtd.stats.html" class="external-link">wtd.quantile</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">fem_diff</span>, </span>
<span>                              w <span class="op">=</span> <span class="va">acount</span>, probs <span class="op">=</span> <span class="fl">0.25</span><span class="op">)</span>, </span>
<span>            iqr_wtd_75 <span class="op">=</span> <span class="fu">Hmisc</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/Hmisc/man/wtd.stats.html" class="external-link">wtd.quantile</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">fem_diff</span>, </span>
<span>                              w <span class="op">=</span> <span class="va">acount</span>, probs <span class="op">=</span> <span class="fl">0.75</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">df_wtd_country</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 9 × 4</span></span></span>
<span><span class="co">#&gt;   COUNTRY       mean_wtd iqr_wtd_25 iqr_wtd_75</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> Bolivia         -<span style="color: #BB0000;">0.528</span>     -<span style="color: #BB0000;">0.617</span>     -<span style="color: #BB0000;">0.431</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> Brazil          -<span style="color: #BB0000;">0.511</span>     -<span style="color: #BB0000;">0.647</span>     -<span style="color: #BB0000;">0.344</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> Colombia        -<span style="color: #BB0000;">0.466</span>     -<span style="color: #BB0000;">0.599</span>     -<span style="color: #BB0000;">0.390</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> Ecuador         -<span style="color: #BB0000;">0.690</span>     -<span style="color: #BB0000;">0.792</span>     -<span style="color: #BB0000;">0.577</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> French Guiana   -<span style="color: #BB0000;">0.401</span>     -<span style="color: #BB0000;">0.496</span>     -<span style="color: #BB0000;">0.294</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> Guyana          -<span style="color: #BB0000;">0.289</span>     -<span style="color: #BB0000;">0.305</span>     -<span style="color: #BB0000;">0.208</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">7</span> Peru            -<span style="color: #BB0000;">0.625</span>     -<span style="color: #BB0000;">0.712</span>     -<span style="color: #BB0000;">0.530</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">8</span> Suriname        -<span style="color: #BB0000;">0.299</span>     -<span style="color: #BB0000;">0.351</span>     -<span style="color: #BB0000;">0.241</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">9</span> Venezuela       -<span style="color: #BB0000;">0.372</span>     -<span style="color: #BB0000;">0.482</span>     -<span style="color: #BB0000;">0.292</span></span></span></code></pre></div>
</div>
</div>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<p>Bienvenu F, Legendre S. 2015. A new approach to the generation time
in matrix population models. The American Naturalist. 185(6):834-43. <a href="https://doi.org/10.1086/681104" class="external-link uri">https://doi.org/10.1086/681104</a>.</p>
<p>Chaves, W.A., Valle, D., Tavares, A.S., Morcatty, T.Q. and Wilcove,
D.S. 2021. Impacts of rural to urban migration, urbanization, and
generational change on consumption of wild animals in the Amazon.
Conservation Biology, 35: 1186-1197. <a href="https://doi.org/10.1111/cobi.13663" class="external-link uri">https://doi.org/10.1111/cobi.13663</a></p>
<p>IUCN. 2001. IUCN Red List Categories and Criteria: Version 3.1. IUCN
Species Survival Commission. IUCN, Gland, Switzerland and Cambridge,
U.K.</p>
<p>IUCN. 2012. IUCN Red List Categories and Criteria: Version 3.1.
Second edition. IUCN, Gland, Switzerland and Cambridge, UK. Available at
www.iucnredlist.org/technical-documents/categories-and-criteria</p>
<p>IUCN. 2024. Guidelines for Using the IUCN Red List Categories and
Criteria. Version 16. Prepared by the Standards and Petitions Committee.
Downloadable from <a href="https://www.iucnredlist.org/documents/RedListGuidelines.pdf" class="external-link uri">https://www.iucnredlist.org/documents/RedListGuidelines.pdf</a>.</p>
<p>Jones OR, Barks P, Stott IM, James TD, Levin SC, Petry WK, Capdevila
P, Che-Castaldo J, Jackson J, Römer G, Schuette C, Thomas CC,
Salguero-Gómez R. 2022. Rcompadre and Rage - two R packages to
facilitate the use of the COMPADRE and COMADRE databases and calculation
of life history traits from matrix population models. Methods in Ecology
and Evolution, 13, 770-781. <a href="doi:10.1111/2041-210X.13792" class="uri">doi:10.1111/2041-210X.13792</a>.</p>
<p>Norris D, Peres CA, Michalski F, Gibbs JP. 2019. Prospects for
freshwater turtle population recovery are catalyzed by pan-Amazonian
community-based management. Biological Conservation. 233:51-60. <a href="https://doi.org/10.1016/j.biocon.2019.02.022" class="external-link uri">https://doi.org/10.1016/j.biocon.2019.02.022</a></p>
<p>Stott, I. popdemo vignette: <a href="https://cran.r-project.org/web/packages/popdemo/vignettes/popdemo.html" class="external-link uri">https://cran.r-project.org/web/packages/popdemo/vignettes/popdemo.html</a></p>
<p>Stott, I., Hodgson, D.J. and Townley, S. 2012. popdemo: an R package
for population demography using projection matrix analysis. Methods in
Ecology and Evolution, 3: 797-802. <a href="https://doi.org/10.1111/j.2041-210X.2012.00222.x" class="external-link uri">https://doi.org/10.1111/j.2041-210X.2012.00222.x</a></p>
<p>Stubben, C., &amp; Milligan, B. 2007. Estimating and Analyzing
Demographic Models Using the popbio Package in R. Journal of Statistical
Software, 22(11), 1–23. <a href="https://doi.org/10.18637/jss.v022.i11" class="external-link uri">https://doi.org/10.18637/jss.v022.i11</a></p>
<p>Tregidgo, D. J., Barlow, J., Pompeu, P. S., de Almeida Rocha, M.,
&amp; Parry, L. 2017. Rainforest metropolis casts 1,000-km defaunation
shadow. Proceedings of the National Academy of Sciences, 114(32),
8655-8659. <a href="https://doi.org/10.1073/pnas.161449911" class="external-link uri">https://doi.org/10.1073/pnas.161449911</a></p>
<p>Zalles V, Hansen Matthew C, Potapov Peter V, Parker D, et al. 2021.
Rapid expansion of human impact on natural land in South America since
1985. Science Advances, 7: eabg1620. <a href="https://doi.org/10.1126/sciadv.abg1620" class="external-link uri">https://doi.org/10.1126/sciadv.abg1620</a></p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Darren Norris.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
